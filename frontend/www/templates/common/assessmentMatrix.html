<ion-view view-title='Assessment Matrix'>
    <ion-nav-buttons side="right">
        <a href="/#tab/assessments" style="font-size:1.2em;">Assessments >></a>
    </ion-nav-buttons>
    <ion-content has-bouncing="false">
        <div style="text-align:center; margin-top: 1em;">
            <h3>{{a.sectionCurrentName()}}</h3>
            <h4>Competency Summary Matrix</h4>

            <select style="margin-top:1em;" class="large" data-ng-model="data.currentInstrumentId"
                    data-ng-change="setCurrentInstrument(data.currentInstrumentId)"
                    data-ng-options="instrument.id as instrument.name for instrument in data.instruments">
            </select>
        </div>
        <div style="overflow: auto !important;">
            <table class="matrix">
                <thead>
                <tr>
                    <th style="font-style: italic;">{{'Most Recent'|translate}}<br/>{{'Member Assessments'|translate}}</th>
                    <th class="rotate" data-ng-repeat="name in getColHeaderNames() track by $index">
                        <div><span>{{name|translate}}</span></div>
                    </th>
                    <th class="rotate">
                        <div><span style="font-weight:bold; color:#555; font-style:italic;">{{'Averages'|translate}}</span></div>
                    </th>
                </tr>
                </thead>
                <tbody>
                <tr data-ng-repeat="dataRow in getMatrixPortion()">
                    <td class="leftHeader" data-ng-class="dataRow.memberId == -1? 'average':''">
                        <div data-ng-switch="dataRow.memberId">
                            <div data-ng-switch-when="-1" style="text-align: right;">
                                {{dataRow.name}}
                            </div>
                            <div data-ng-switch-default>
                                <a href="/#/manager/member/{{dataRow.memberId}}">
                                    <avatar site="siteDir()" sz="'tiny'" member-id="dataRow.memberId" level="dataRow.lv" alt=""></avatar>
                                </a>
                                <a href="/#/manager/member/{{dataRow.memberId}}">{{dataRow.ln}}, {{dataRow.fn}}</a>
                            </div>
                        </div>
                    </td>
                    <td data-ng-show="inSection($index)" data-ng-repeat="response in dataRow.responses track by $index"
                        data-ng-class="dataRow.memberId == -1? 'average':''">
                        <div data-ng-class="getCellClass(response[0], response[1])">
                            <div data-ng-switch="dataRow.memberId">
                                <div data-ng-switch-when="-1">
                                    {{response[0]|number:1}}
                                </div>
                                <div data-ng-switch-default>
                                    {{response[0]|number:0}}
                                </div>
                            </div>
                    </td>
                    <td class="average">
                        <div data-ng-class="getCellClass(dataRow.avg, dataRow.typeName)"
                             data-ng-bind="dataRow.typeName == 'MIXED'? 'N/A' : dataRow.avg">
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        <div class="row row-responsive-sm">
            <div class="col col-40" style="text-align:right;">
                <div class="instrumentNavBtn pull-right"><a data-ng-click="previous()"><< {{previousName()}}</a></div>
            </div>
            <div class="col col-10" style="text-align:center;">|</div>
            <div class="col col-40" style="text-align:left;">
                <div class="instrumentNavBtn pull-left"><a data-ng-click="next()">{{nextName()}} >></a></div>
            </div>
        </div>
        <div class="row row-responsive-sm">
            <div class="col" style="text-align:center;">
                <a class="button" data-ng-if="!isAll()" data-ng-click="viewAll()">View All Competencies</a>
                <a class="button" data-ng-if="!isSummary()" data-ng-click="viewSummary()">View Section Summary</a>
            </div>
        </div>
    </ion-content>
</ion-view>
