<ion-view view-title='Evaluation Matrix'>
    <ion-nav-buttons side="right">
        <a href="/#tab/evaluations" style="font-size:1.2em;">Evaluations >></a>
    </ion-nav-buttons>
    <ion-content has-bouncing="false" data-ng-init="e.getMatrixData(instrumentId)">
        <div style="text-align:center; margin-top: 1em;">
            <h3>{{a.sectionCurrentName()}}</h3>
            <h4>Competency Summary Matrix</h4>

            <select class="large" data-ng-change="e.getMatrixData(e.currentInstrumentId)" data-ng-model="e.currentInstrumentId">
                <option data-ng-repeat="instrument in e.instruments" value="{{instrument.id}}">{{instrument.name}}</option>
            </select>
        </div>
    <div style="overflow: auto !important;">
        <table class="matrix">
            <thead>
            <tr>
                <th style="font-style: italic;">Most Recent<br/>Member Evaluations</th>
                <th class="rotate" data-ng-repeat="name in e.findMatrixResponseRowHeader(20,e.currentSectionIdx) track by $index">
                    <div><span>{{name}}</span></div>
                </th>
                <th class="rotate">
                    <div><span>Average</span></div>
                </th>
            </tr>
            </thead>
            <tbody>
            <tr data-ng-repeat="dataRow in e.matrix">
                <td class="leftHeader" data-ng-init="member = m.find(dataRow.memberId)">
                    <div data-ng-switch="dataRow.memberId">
                        <div data-ng-switch-when="-1">
                            Averages
                        </div>
                        <div data-ng-switch-default>
                            <img class="avatar-tiny" data-ng-src="{{member.avatar}}" alt="">
                            <a href="/#/manager/member/{{dataRow.memberId}}">{{member.lastName}}, {{member.firstName}}</a>
                        </div>
                    </div>
                </td>
                <td data-ng-repeat="response in e.findMatrixResponseRowValues(e.currentSectionIdx, dataRow.responses) track by $index">
                    <div class="matrixCircle levelBg{{response | number:0}}">{{response|number:0}}</div>
                </td>
                <td>
                    <div class="matrixCircle levelBg{{dataRow.avgRound}}">{{dataRow.avg|number:0}}</div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
        <div class="row row-responsive-sm">
            <div class="col col-40" style="text-align:right;">
                <a data-ng-click="e.sectionPrevious()"><< {{e.sectionPreviousName()}}</a>
            </div>
            <div class="col col-10" style="text-align:center;">|</div>
            <div class="col col-40" style="text-align:left;">
                <a data-ng-click="e.sectionNext()">{{e.sectionNextName()}} >></a>
            </div>
        </div>
        <div class="row row-responsive-sm">
            <div class="col" style="text-align:center;">
                <a class="button" data-ng-if="!e.sectionIsAll()" data-ng-click="e.sectionViewAll()">View All Competencies</a>
                <a class="button" data-ng-if="!e.sectionIsSummary()" data-ng-click="e.sectionViewSummary()">View Section Summary</a>
            </div>
        </div>
    </ion-content>
</ion-view>
