<ion-view view-title="Assessment">
    <ion-nav-buttons side="left"><a data-ng-href="{{dashboardUrl()}}" data-ng-bind-html="installation.logo"></a></ion-nav-buttons>
    <ion-nav-buttons side="right"><a data-ng-click="logout()"><i class="logo ion-log-out"></i></a></ion-nav-buttons>
    <ion-content has-bouncing="false" overflow-scroll="true">
        <div style="float:right; margin-right: 0.4em;">
            <button data-ng-if="canEdit() && data.assessment.es!='L'" class="button button-action button-save" data-ng-click="save()">
                <i class="{{i.icons.save}}"></i> Save
            </button>
            <button data-ng-if="canLock()" class="button button-action button-{{data.assessment.es=='L'?'unlock':'lock'}}" data-ng-click="toggleLock()">
                <i class="{{data.assessment.es=='L'? i.icons.unlocked : i.icons.locked}}"></i>
            </button>
            <button class="button button-action button-pdf" data-ng-click="printIt()"><i class="{{i.icons.pdf}}"></i></button>
            <div class="clearfix"></div>
        </div>
        <div>
            <div class="row responsive-sm">
                <div class="col col-100"><h3 style="text-align: center; margin:0 auto;">{{data.assessment.instrument.nm}}</h3></div>
            </div>
            <div class="row responsive-sm detail">
                <div class="col col-25 padding" style="text-align:center;">
                    <a href="#/manager/member/{{data.assessment.member.id}}">
                        <img class="border border{{Assessments.avgRound}}" data-ng-src="{{data.assessment.member.av}}" alt=""/>
                    </a>
                    <div class="name"><a href="#/manager/member/{{data.assessment.member.id}}">
                        {{data.assessment.member.fn}} {{data.assessment.member.ln}}</a>
                    </div>
                    <div class="role">{{data.assessment.member.rl}}</div>
                    <div class="score" data-ng-show="Assessments.avgRound > 0">
                        <i class="logo level levelColor{{Assessments.avgRound}} {{i.icons.levels[Assessments.avgRound]}}">
                            {{Assessments.scoreWord(Assessments.avgRound)}} <span style="font-size:0.6em;">({{Assessments.avg}})</span>
                        </i>
                    </div>
                    <div>
                        Performed by: {{data.assessment.assessor.fn}} {{data.assessment.assessor.ln}}
                        <img class="avatar-tiny" src="{{data.assessment.assessor.av}}" alt=""/>
                    </div>
                </div>
                <div class="col col-75">
                    <h5 data-ng-bind-html="installation.trademarkName + ' Recommended Modules'"></h5>

                    <div class="recommendationsPane">
                        <div class="item" data-ng-repeat="recommendation in data.recommendations">
                            <a href="/#/manager/resource/{{recommendation.resourceId}}">
                                <i class="{{i.icons.resource}}"></i>{{recommendation.number}} {{recommendation.name}} (score: {{recommendation.score|number:4}})
                            </a>
                            <recommendation-ranking weight="recommendation.weight" range="[1,1,1,1,1]" n="recommendation.weight"></recommendation-ranking>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row responsive-sm detail">
                <div class="col col-100 assessment">
                    <div style="display:none;">{{data.assessment.lm}}</div>
                    <div id="section{{$index}}" data-ng-repeat="section in data.assessment.instrument.sections" class="fadein fadeout">
                        <div data-ng-show="Instruments.sectionIsCurrent(data.assessment.instrument, section.id)">
                            <div style="float:left; margin-left:1em;">
                                <a ng-click="Instruments.sectionPrevious(data.assessment.instrument)"><< {{section.previous}}</a>
                            </div>
                            <div style="float:right; margin-right:1em;">
                                <a ng-click="Instruments.sectionNext(data.assessment.instrument)">{{section.next}}>></a>
                            </div>
                            <div class="clearfix"></div>
                            <div style="height:1em;"></div>
                            <ion-list>
                                <ion-item class="top">
                                    <h2 style="float:left;">{{section.number}} {{section.name}}</h2>
                                </ion-item>
                                <ion-item class="item-remove-animate item-icon-right" data-ng-repeat="question in section.questions" type="item-text-wrap">
                                    <div style="float:left; max-width: 80%;">
                                        <div class="number" data-ng-bind="section.number + '.' + question.nb"></div>
                                        <div class="text" data-ng-bind="question.nm"></div>
                                        <div class="clearfix"></div>
                                        <div class="description" data-ng-bind-html="question.dsc"></div>
                                    </div>
                                    <div data-ng-switch="data.assessment.es" class="response">
                                        <div data-ng-switch-when="A">
                                            <div data-ng-switch="question.typ" style="float:right;">
                                                <div data-ng-switch-when="NAYesNo">
                                                    <div class="button-bar" style="max-width:12em; min-width:12em;">
                                                        <a class="button" data-ng-class="{'yesNoBg0': question.rsp.ri == 0}"
                                                           data-ng-click="updateResponse(question, 0)">N/A</a>
                                                        <a class="button" data-ng-class="{'yesNoBg1': question.rsp.ri == 1}"
                                                           data-ng-click="updateResponse(question, 1)">No</a>
                                                        <a class="button" data-ng-class="{'yesNoBg2': question.rsp.ri == 2}"
                                                           data-ng-click="updateResponse(question, 2)">Yes</a>
                                                    </div>
                                                </div>
                                                <div data-ng-switch-default="">
                                                    <slider id="question_item_{{question.id}}" class="slider{{question.rsp.ri}}"
                                                            data-ng-model="question.rsp.ri" floor="0.0" ceiling="5" step-width="1"
                                                            data-ng-change="updateSliderResponse(question, this, true)"
                                                            data-translate-fn="sliderTranslate"
                                                            >
                                                    </slider>
                                                </div>
                                            </div>
                                        </div>
                                        <div data-ng-switch-default="">
                                            <div data-ng-class="getResponseClass(question.typ, question.rsp.ri)">{{question.rsp.r}}</div>
                                        </div>
                                    </div>
                                    <div class="clearfix"></div>
                                    <div>
                                        <div class="pull-left">
                                            <a data-ng-click="question.showComments = (question.showComments == undefined? true : !question.showComments)">
                                                <i data-ng-class="hasComment(question)? i.icons.noteFilled : i.icons.noteEmpty"></i>
                                            </a>
                                        </div>
                                        <div class="pull-left" style="margin-left:1em;">
                                            <div data-ng-switch="showComment(question)">
                                                <div data-ng-switch-when="true">
                                                <textarea cols="60" rows="3" data-ng-model="question.rsp.ac"
                                                          data-ng-bind="question.rsp.ac"></textarea>
                                                </div>
                                                <div data-ng-switch-when="false">
                                                    <p class="comments" data-ng-bind-html="getComment(question)"></p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="clearfix"></div>
                                    </div>
                                </ion-item>
                            </ion-list>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </ion-content>
</ion-view>
