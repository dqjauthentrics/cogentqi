<ion-view view-title="Assessment">
    <ion-nav-buttons side="left"><a data-ng-href="{{dashboardUrl()}}" data-ng-bind-html="installation.logo"></a></ion-nav-buttons>
    <ion-nav-buttons side="right"><a data-ng-click="logout()"><i class="logo {{i.signOut}}"></i></a></ion-nav-buttons>
    <ion-content has-bouncing="false" overflow-scroll="true">
        <page-loader i="i" loading="data.isLoading"></page-loader>
        <div style="float:left; margin:0.2vw 1vw 0 0;" ng-show="!data.isLoading">
            <h1 style="margin:0">{{Assessments.current.instrument.n}}</h1>

            <div>
                Performed by: {{Assessments.current.assessor.fn}} {{Assessments.current.assessor.ln}}
                <a href="/#/member/view/{{Assessments.current.assessor.id}}">
                    <avatar site="siteDir()" sz="'tiny'" member-id="Assessments.current.assessor.id" level="0" alt="avatarAlt(data.assessor)"></avatar>
                </a>
            </div>
        </div>
        <div class="iconBar" ng-show="!data.isLoading">
            <button id="assessmentSave" data-ng-if="canEdit() && Assessments.current.es!='L'"
                    class="button button-action button-save {{data.dirty? 'button-dirty':'button-clean'}}" data-ng-click="save($event)">
                <i class="{{i.save}}"></i>
            </button>
            <button data-ng-if="canLock()" class="button button-action button-{{Assessments.current.es=='L'?'unlock':'lock'}}" data-ng-click="toggleLock()">
                <i class="{{Assessments.current.es=='L'? i.unlocked : i.locked}}"></i>
            </button>
            <button data-ng-if="canRemove() && Assessments.current.es!='L'" class="button button-action button-remove" data-ng-click="remove()">
                <i class="{{i.remove}}"></i>
            </button>
            <button class="button button-action button-pdf" data-ng-click="printIt()"><i class="{{i.pdf}}"></i></button>
            <div class="clearfix"></div>
        </div>
        <div class="row responsive-md" ng-show="!data.isLoading">
            <div class="col col-25 assessmentNameCardWrap" style="text-align: center;">
                <assessment-name-card site="siteDir()" member="Assessments.current.member" assessment="Assessments.current"></assessment-name-card>
            </div>
            <div class="col col-75 recommendationsPaneWrao">
                <assessment-recommendations title="data.recommendationsTitle" items="data.recommendations"></assessment-recommendations>
            </div>
        </div>
        <div class="row responsive-lg detail" ng-show="!data.isLoading">
            <div class="col col-100 assessment">
                <div style="display:none;">{{Assessments.current.lm}}</div>
                <div id="section{{$index}}" data-ng-repeat="section in Assessments.current.instrument.sections" class="fadein fadeout">
                    <div data-ng-show="Instruments.sectionIsCurrent(Assessments.current.instrument, section.id)">
                        <div class="instrumentNavBtn pull-left">
                            <a ng-click="Instruments.sectionPrevious(Assessments.current.instrument)"><< {{section.prv|ellipsify:22}}</a>
                        </div>
                        <div class="instrumentNavBtn pull-right">
                            <a ng-click="Instruments.sectionNext(Assessments.current.instrument)">{{section.nxt|ellipsify:22}} >></a>
                        </div>
                        <div class="clearfix"></div>
                        <div style="height:1em;"></div>
                        <ion-list>
                            <ion-item class="top">
                                <h2 style="float:left;">{{section.nmb}} {{section.n}}</h2>
                            </ion-item>
                            <ion-item class="item-remove-animate" data-ng-repeat="question in section.questions" type="item-text-wrap">
                                <div>
                                    <div style="display:table-row;">
                                        <div style="display:table-cell;" class="number" data-ng-bind="section.nmb + '.' + question.nmb"></div>
                                        <div style="display:table-cell; line-height: 1em;" class="text" data-ng-bind="question.n"></div>
                                    </div>
                                    <div class="description" data-ng-bind-html="question.dsc"></div>
                                </div>
                                <assessment-response></assessment-response>
                                <div class="clearfix"></div>
                                <div>
                                    <div class="pull-left">
                                        <a data-ng-click="question.showComments = (question.showComments == undefined? true : !question.showComments)">
                                            <i data-ng-class="hasComment(question)? i.noteFilled : i.noteEmpty"></i>
                                        </a>
                                    </div>
                                    <div class="pull-left" style="margin-left:1em;">
                                        <div data-ng-switch="showComment(question)">
                                            <div data-ng-switch-when="true">
                                                <textarea cols="60" rows="3" data-ng-model="question.rsp.ac" data-ng-bind="question.rsp.ac"></textarea>
                                            </div>
                                            <div data-ng-switch-when="false">
                                                <p class="comments" data-ng-bind-html="getComment(question)"></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                            </ion-item>
                        </ion-list>
                    </div>
                </div>
            </div>
        </div>
    </ion-content>
</ion-view>
