<ion-view view-title="Settings">
    <ion-nav-buttons side="left"><a data-ng-href="{{dashboardUrl()}}" data-ng-bind-html="installation.logo"></a></ion-nav-buttons>
    <ion-nav-buttons side="right"><a data-ng-click="logout()"><i class="logo ion-log-out"></i></a></ion-nav-buttons>
    <ion-content has-bouncing="false">
        <div class="row responsive-sm" data-ng-if="!isIOS">
            <div class="col col-50" style="text-align: center;">
                <canvas id="snapshot" width="320" height="240"></canvas>
                <div class="clearfix"></div>
                <button data-ng-show="shotReady" class="button button-balanced" onclick="alert('Sorry, this is just a demo.')">Save this as My Photo</button>
            </div>
            <div class="col col-50" style="text-align: center;">
                <webcam channel="webcamChannel" on-stream="webcamStream(stream)" on-streaming="webcamSuccess()" on-error="webcamError(err)"></webcam>
                <div class="clearfix"></div>
                <div data-ng-show="!webcamReady">Allow your browser to use your video camera (probably a message waiting for you above).</div>
                <button data-ng-show="webcamReady" class="button button-balanced" data-ng-click="makeSnapshot()">Say "Cheese" and Press Me!</button>
            </div>
        </div>
        <div data-ng-if="isIOS">
            <style>
                #yourimage {
                    width: 100%;
                }

                #swatches {
                    width: 100%;
                    height: 50px;
                }

                .swatch {
                    width: 18%;
                    height: 50px;
                    border-style: solid;
                    border-width: thin;
                    float: left;
                    margin-right: 3px;
                }
            </style>
            <script type="text/javascript" charset="utf-8" src="/lib/quantize.js"></script>
            <script type="text/javascript" charset="utf-8" src="/lib/color-thief/dist/color-thief.min.js"></script>
            <input type="file" capture="camera" accept="image/*" id="takePictureField">

            <img id="yourimage">

            <div id="swatches">
                <div id="swatch0" class="swatch"></div>
                <div id="swatch1" class="swatch"></div>
                <div id="swatch2" class="swatch"></div>
                <div id="swatch3" class="swatch"></div>
                <div id="swatch4" class="swatch"></div>
            </div>
            <script>
                var desiredWidth;

                $(document).ready(function () {
                    console.log('onReady');
                    $("#takePictureField").on("change", gotPic);
                    $("#yourimage").load(getSwatches);
                    desiredWidth = window.innerWidth;

                    if (!("url" in window) && ("webkitURL" in window)) {
                        window.URL = window.webkitURL;
                    }

                });

                function getSwatches() {
                    var colorArr = createPalette($("#yourimage"), 5);
                    for (var i = 0; i < Math.min(5, colorArr.length); i++) {
                        $("#swatch" + i).css("background-color", "rgb(" + colorArr[i][0] + "," + colorArr[i][1] + "," + colorArr[i][2] + ")");
                        console.log($("#swatch" + i).css("background-color"));
                    }
                }
                function gotPic(event) {
                    if (event.target.files.length == 1 &&
                            event.target.files[0].type.indexOf("image/") == 0) {
                        $("#yourimage").attr("src", URL.createObjectURL(event.target.files[0]));
                    }
                }
            </script>
        </div>
        <div class="row responsive-sm">
            <div class="col col-100">
                <ion-list type="card">
                    <ion-item class="top">Settings for {{user.firstName}} {{user.lastName}}</ion-item>
                    <ion-item data-ng-repeat="setting in data.settings">
                        <ion-toggle data-ng-model="settings.v">{{setting.n}}</ion-toggle>
                    </ion-item>
                </ion-list>
            </div>
        </div>
    </ion-content>
</ion-view>
<style>
    .button {
        margin: 1em;
    }
</style>
